# ボール・選手 統合データセット仕様書

このドキュメントは、テニスのボール追跡および選手姿勢推定タスクに使用されるデータセットの構造と仕様について詳述します。

## 1. データセット概要

本データセットは、テニスの試合映像から切り出されたフレーム画像と、それに対応するボールおよび選手のアノテーション情報から構成されます。**単一のアノテーションファイル内に、ボールと選手の両方のカテゴリが共存している点が特徴です。** アノテーションはCOCO (Common Objects in Context) 形式に準拠しています。

- **画像数**: 19,106枚
- **アノテーション数**: 56,965件 (ボール: 19,106件, 選手: 37,859件)
- **データ格納先**:
  - **画像**: `data/processed/ball/images/`
  - **アノテーションファイル**: `data/processed/ball/annotation.json`

## 2. アノテーション形式 (COCO準拠)

アノテーションファイル (`annotation.json`) は、以下の主要なキーを持つJSONオブジェクトです。

- `images`: 画像に関する情報リスト
- `annotations`: アノテーション情報リスト
- `categories`: カテゴリ定義リスト

### 2.1. `images`

各要素は単一の画像を表すオブジェクトです。

- `id` (int): 画像のユニークID
- `file_name` (str): 画像ファイル名
- `width` (int): 画像の幅 (ピクセル)
- `height` (int): 画像の高さ (ピクセル)

### 2.2. `annotations`

各要素は単一のオブジェクト（ボールまたは選手）に対するアノテーションです。

- `id` (int): アノテーションのユニークID
- `image_id` (int): 対応する画像のID
- `category_id` (int): 対応するカテゴリのID (`1` for ball, `2` for player)
- `bbox` (list[float]): バウンディングボックス `[x, y, width, height]`
- `area` (float): バウンディングボックスの面積
- `keypoints` (list[int]): キーポイントのリスト
- `num_keypoints` (int): 可視（`v > 0`）なキーポイントの数 (主に選手のアノテーションで使用)

#### キーポイントの可視性 (`v`)

- `v = 0`: アノテーションなし（画像内に存在しない、またはラベル付けされていない）
- `v = 1`: 隠れている（Occluded）
- `v = 2`: 見えている（Visible）

### 2.3. `categories`

オブジェクトのカテゴリを定義します。本データセットには`ball`と`player`の2つのカテゴリが存在します。

#### カテゴリ1: `ball`

- **ID**: 1
- **カテゴリ名**: `ball`
- **キーポイント**: `['center']` (1点)
- **スケルトン**: なし
- **特記事項**: ボールのバウンディングボックスの面積は常に`64`に固定されています。

#### カテゴリ2: `player`

- **ID**: 2
- **カテゴリ名**: `player`
- **キーポイント**: 17個のキーポイントの名前リスト。
- **スケルトン**: キーポイント間の接続情報。

##### キーポイント定義 (`player`)

| インデックス | キーポイント名 |
| :--- | :--- |
| 0 | `nose` |
| 1 | `left_eye` |
| 2 | `right_eye` |
| 3 | `left_ear` |
| 4 | `right_ear` |
| 5 | `left_shoulder` |
| 6 | `right_shoulder` |
| 7 | `left_elbow` |
| 8 | `right_elbow` |
| 9 | `left_wrist` |
| 10 | `right_wrist` |
| 11 | `left_hip` |
| 12 | `right_hip` |
| 13 | `left_knee` |
| 14 | `right_knee` |
| 15 | `left_ankle` |
| 16 | `right_ankle` |

##### スケルトン定義 (`player`)

```json
[
  [16, 14], [14, 12], [17, 15], [15, 13], [12, 13], 
  [6, 12], [7, 13], [6, 7], [6, 8], [8, 10], 
  [7, 9], [9, 11], [2, 3], [1, 2], [1, 3], 
  [2, 4], [3, 5], [4, 6], [5, 7]
]
```

## 3. データセットの分析（参考）

`notebooks/ball_and_player_data_analysis.ipynb` で実施された分析により、以下の点が明らかになっています。

- **カテゴリ分布**: データセットには選手のアノテーションがボールのアノテーションよりも多く含まれています（選手: 約66%, ボール: 約34%）。
- **ボールの可視性**: ほとんどのボールは「表示(v=2)」としてアノテーションされていますが、「オクルージョン(v=1)」や「ラベルなし(v=0)」のデータも少数存在します。
- **選手のキーポイント**: 全てのアノテーションが17個全てのキーポイントを持っているわけではありません。アノテーションごとの有効なキーポイント数の分布にはばらつきがあります。
- **バウンディングボックス**: 選手のバウンディングボックスの面積は、小さいものから大きいものまで様々です。