# 計画: DINOv3を用いたシーケンシャル画像特徴量の事前エンコード

## 1. 概要

本計画では、ビデオなどのシーケンシャルな画像列から、ボール検出、プレーヤー検出、さらにはイベント検出（バウンド、ヒットなど）といった高度なタスクを実行するための新しいアーキテクチャを導入する。

中核となるアイデアは、強力な画像特徴量エンコーダーである **DINOv3** を活用し、事前に画像シーケンスの特徴量を計算・保存することである。

## 2. アーキテクチャ

提案するアーキテクチャは、大きく2つのステージで構成される。

### ステージ1: 特徴量の事前エンコードと保存

1.  **入力:** ビデオクリップ（シーケンシャルな画像フレーム列）。
2.  **処理:**
    - DINOv3モデル（凍結状態）を使用して、各画像フレームを個別にエンコードし、高次元の特徴量ベクトルを抽出する。
    - ビデオクリップごとに、フレームに対応した特徴量ベクトルのシーケンスを生成する。
3.  **出力:** 抽出した特徴量シーケンスをファイル（例: `.pt`, `.npy`）として保存する。これにより、元の画像データを都度読み込む必要がなくなる。

### ステージ2: 下流タスクモデルの学習

1.  **入力:** 事前計算された特徴量シーケンス。
2.  **モデル:**
    - シーケンシャルなデータ処理に適したモデル（例: LSTM, GRU, Transformerベースのデコーダー）を入力として受け取る。
    - このモデルが、特徴量シーケンスから目的のタスク（ボールの軌跡、プレーヤーの位置、イベントの発生タイミングなど）を予測するように学習する。
3.  **学習タスクの例:**
    - **ボール/プレーヤー検出:** 各タイムステップでの位置座標を回帰する。
    - **イベント検出:** 各タイムステップでイベント（ヒット、バウンド等）が発生したかどうかを分類する。

## 3. 事前エンコードの利点

このアプローチの最大の利点は、**学習サイクルの高速化**である。

- 通常、DINOv3のような大規模モデルを学習パイプラインに組み込むと、フォワードパスだけでも相当な計算時間を要する。
- モデルを凍結してデコーダー部分のみを学習させる場合でも、エポックごとに全データセットに対してエンコード処理を繰り返すのは非効率である。
- 特徴量を事前に計算しておくことで、デコーダーの学習時には、軽量な特徴量ファイルを読み込むだけで済む。これにより、DINOv3のエンコード処理がボトルネックになることを防ぎ、デコーダーのアーキテクチャやハイパーパラメータの試行錯誤を極めて高速に行うことができる。

## 4. 次のステップ

1.  DINOv3による画像エンコード用のスクリプトを作成する。
2.  データセット全体に対して特徴量抽出を実行し、結果を保存する。
3.  特徴量シーケンスを入力とする簡単なデコーダーモデル（例: LSTM）を実装し、ボール検出タスクで学習を試みる。
