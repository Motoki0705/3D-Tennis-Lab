# GEMINI分析レポート：3Dテニス自動解析システム

## 1. 目的と概要

このリポジトリは、テニスの試合映像を自動解析するシステムを開発することを目的としています。主な機能は以下の通りです。

-   **3D情報抽出**: 映像からコート、プレーヤー、ボールの動きを3次元情報として抽出します。
-   **イベント検出**: 抽出した3Dデータに基づき、サーブ、ラリー、ショットなどの戦術的イベントを検出します。
-   **統合解析**: 試合全体の統計データ（サーブ成功率、ラリー数など）を算出し、可視化します。
-   **将来展望**: 解析結果を大規模言語モデル（LLM）に入力し、試合の要約や戦術解説を自動生成することを目指しています。

## 2. 技術スタック

本プロジェクトで使用されている主要な技術は以下の通りです。

-   **プログラミング言語**: Python 3.11
-   **依存関係管理**: Poetry
-   **開発・実行環境**: Docker, VS Code Dev Containers
-   **テスト**: Pytest, pytest-cov, tox
-   **コード品質**:
    -   **リンター/フォーマッター**: Ruff
    -   **静的型チェック**: Mypy
    -   **コミット前フック**: pre-commit
    -   **その他**: Prettier, nbstripout
-   **ドキュメンテーション**: MkDocs (Materialテーマ)
-   **CI/CD**: pre-commit.ci, GitHub Actions (推測)
-   **主要ライブラリ**:
    -   現時点の`pyproject.toml`には、主に開発ツールやドキュメンテーションツールが記載されています。
    -   プロジェクト計画書から、今後は**Humans4D**, **Transformer**, **GNN (Graph Neural Networks)** などの機械学習・コンピュータビジョン関連ライブラリの導入が想定されます。

## 3. プロジェクト構造

主要なディレクトリとファイルの役割は以下の通りです。

| ディレクトリ/ファイル | 役割 |
| :--- | :--- |
| `3d_tennis_system/` | **統合システムのコアロジック**。完成したモデル群を統合し、推論パイプラインを構築します。 |
| `development/` | **実験室**。コンポーネントごと（コート、選手、ボール等）のモデル開発や試行錯誤を行う場所です。 |
| `configs/` | モデルや学習、データ処理に関する設定ファイル（YAML, TOML等）を管理します。 |
| `data/` | 学習や評価に使用する元データ（動画、アノテーション）や中間生成物を格納します。（Git管理対象外） |
| `trained_models/` | 開発を経て選抜された、学習済みのモデル、設定、ログ等を格納します。 |
| `notebooks/` | データ分析、可視化、モデルの試作のためのJupyter Notebookを配置します。 |
| `scripts/` | 学習、推論、データ前処理などを実行するためのユーティリティスクリプト群です。 |
| `tools/` | アノテーション生成など、開発を補助するユーティリティを配置します。 |
| `docs/` | プロジェクト計画書、ブランチ戦略など、プロジェクトに関する全ての資料を格納します。 |
| `tests/` | コードの品質を保証するための単体テスト・結合テストを格納します。 |
| `docker/` | 再現可能な実行環境を定義するDockerfileなどを格納します。 |
| `.devcontainer/` | VS Codeでの開発コンテナ設定を定義します。 |
| `pyproject.toml` | Poetryによるプロジェクトの依存関係とメタ情報を管理します。 |

## 4. 今後の開発ステップ

プロジェクト計画書に基づき、今後の開発は以下のステップで進められると推測されます。

1.  **上流工程：3D情報抽出モデルの開発**
    -   **コート姿勢推定**: カメラの3次元的な位置と向きをフレーム毎に推定するモデルを開発します。
    -   **プレーヤー解析**: `Humans4D`などの技術を活用し、プレーヤーの3Dメッシュ（姿勢、位置、形状）を復元します。
    -   **ボール追跡**: 検出と追跡を統合した単一モデルや、TransformerベースのEnd-to-Endモデルを検討し、オクルージョンに強いボール追跡を実現します。

2.  **下流工程：イベント検出モデルの開発**
    -   **データセット構築**: イベント検出タスクのためのアノテーション付きデータセットを新規に構築します。アノテーションコスト削減のため、自己教師あり学習などの導入を検討します。
    -   **マルチタスク学習**: 「サーブ」「ストローク」「ボレー」など複数のイベントを、単一の統合モデル（TransformerやGNNベース）で同時に検出するモデルを開発します。

3.  **統合と応用**
    -   **統合解析システムの構築**: 上流・下流のモジュールを統合し、ロバストでスケーラブルな解析パイプラインを構築します。
    -   **LLM連携の探求**: 解析結果をLLMに入力し、試合解説を自動生成する機能の開発に着手します。低コストなPEFTなどの手法を中心に研究開発を進める方針です。

## 5. 開発の進め方とルール

本プロジェクトに貢献する際は、開発効率とコードの品質を維持するため、プロセスに応じて適切なドキュメントを参照してください。

### プロジェクト全体

| ドキュメント | 内容と参照タイミング |
| :--- | :--- |
| **[プロジェクト計画書](./docs/core/project_plan.md)** | **[最初に読む]** プロジェクトの目的、アーキテクチャ、技術方針、将来展望など、全体の設計思想をまとめています。新しいメンバーが参加した際に、まず初めに参照してください。 |
| **[ブランチ戦略](./docs/core/branching_strategy.md)** | **[開発を始める前に]** `feature` `fix` といったGitブランチの命名規則や、Pull Requestを用いた開発フローを定義しています。コードを書き始める前に必ず確認してください。 |
| **[コミットメッセージ規約](./docs/core/commit_message_rule.md)** | **[コミットする前に]** Conventional Commitsに準拠したメッセージ規約です。変更履歴を分かりやすく保つため、コミット前に書き方を確認してください。 |
| **[実験的開発の進め方](./development/README.md)** | **[モデル開発を始める前に]** `development`ディレクトリでの実験の進め方、成功したモデルの管理方法など、研究開発の具体的なワークフローを説明しています。 |

### データセット関連

| ドキュメント | 内容と参照タイミング |
| :--- | :--- |
| **[コートデータセット仕様書](./docs/dataset/court_dataset.md)** | **[コート姿勢推定タスクに取り組む際に]** コートのキーポイント定義、アノテーション形式、スケルトン情報など、データセットの仕様を詳述しています。 |
| **[ボール・選手 統合データセット仕様書](./docs/dataset/ball_and_player_dataset.md)** | **[ボール追跡・選手姿勢推定タスクに取り組む際に]** ボールと選手のカテゴリが単一ファイルに統合されたデータセットの仕様です。キーポイント定義やアノテーション形式を詳述しています。 |
